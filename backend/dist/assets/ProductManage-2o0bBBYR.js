import{_ as P,r as U,a as j,o as F,w as I,b as O,c,d,e,f as o,g as a,h as r,i as n,n as R,t as y,u as q,l as J,j as k,k as x,m as A,F as V,s as _,p as G,E as m,q as H,v as K}from"./index-Drt15aFz.js";const L={class:"manage-page"},Q={class:"top-nav"},W={class:"container"},X={class:"container main-wrapper"},Y={class:"left-column"},Z={class:"image-preview-box"},h={class:"status-text"},tt={class:"control-panel"},st={key:0,class:"locked-state"},et={key:1,class:"toggle-state"},ot={class:"current-status"},at={class:"right-column"},lt={class:"form-actions"},nt={__name:"ProductManage",setup(it){const C=G(),$=H(),f=U(!1),s=j({id:0,title:"",description:"",price:0,image:"",status:1}),w=async()=>{f.value=!0;try{const t=(await _.get(`/api/products/${C.params.id}`)).data,p=JSON.parse(localStorage.getItem("user")||"{}");if(t.user_id!==p.id){m.error("您无权管理此商品"),$.replace("/profile");return}Object.assign(s,t)}catch(l){console.error(l)}finally{f.value=!1}},z=async()=>{try{await _.put(`/api/products/${s.id}`,{title:s.title,description:s.description,price:Number(s.price)}),m.success("保存成功")}catch{m.error("保存失败")}},b=l=>{const t=l===1?"上架":"下架";K.confirm(`确定要${t}该商品吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await _.put(`/api/products/${s.id}`,{status:l}),s.status=l,m.success(`商品已${t}`)})},B=l=>({1:"正在出售",2:"交易完成",3:"已下架"})[l],N=l=>({1:"on-sale",2:"sold-out",3:"off-shelf"})[l];return F(w),(l,t)=>{const p=r("el-breadcrumb-item"),M=r("el-breadcrumb"),S=r("el-image"),T=r("el-icon"),u=r("el-button"),g=r("el-input"),v=r("el-form-item"),E=r("el-form"),D=O("loading");return I((d(),c("div",L,[e("div",Q,[e("div",W,[o(M,{separator:"/"},{default:a(()=>[o(p,{to:{path:"/"}},{default:a(()=>[...t[7]||(t[7]=[n("首页",-1)])]),_:1}),o(p,{to:{path:"/profile"}},{default:a(()=>[...t[8]||(t[8]=[n("个人中心",-1)])]),_:1}),o(p,null,{default:a(()=>[...t[9]||(t[9]=[n("管理宝贝",-1)])]),_:1})]),_:1})])]),e("div",X,[e("div",Y,[e("div",Z,[o(S,{src:s.image,fit:"contain",class:"main-img"},null,8,["src"]),e("div",{class:R(["status-overlay",N(s.status)])},[e("span",h,y(B(s.status)),1)],2)]),e("div",tt,[t[15]||(t[15]=e("div",{class:"panel-title"},"商品状态控制",-1)),s.status===2?(d(),c("div",st,[o(T,{class:"lock-icon"},{default:a(()=>[o(q(J))]),_:1}),t[10]||(t[10]=e("p",null,"宝贝已售出，交易快照已锁定",-1)),t[11]||(t[11]=e("span",{class:"sub-tip"},"如需重新出售，请发布新商品",-1))])):(d(),c("div",et,[e("p",ot,[t[12]||(t[12]=n(" 当前状态： ",-1)),e("span",{style:A({color:s.status===1?"#67c23a":"#f56c6c"})},y(s.status===1?"正在出售中":"已放入仓库"),5)]),s.status===1?(d(),k(u,{key:0,type:"warning",round:"",class:"action-btn",onClick:t[0]||(t[0]=i=>b(3))},{default:a(()=>[...t[13]||(t[13]=[n("下架商品",-1)])]),_:1})):x("",!0),s.status===3?(d(),k(u,{key:1,type:"success",round:"",class:"action-btn",onClick:t[1]||(t[1]=i=>b(1))},{default:a(()=>[...t[14]||(t[14]=[n("重新上架",-1)])]),_:1})):x("",!0)]))])]),e("div",at,[t[22]||(t[22]=e("div",{class:"form-header"},[e("h2",null,"编辑商品信息"),e("span",{class:"sub-text"},"完善信息有助于更快卖出哦")],-1)),o(E,{model:s,"label-position":"top",class:"edit-form"},{default:a(()=>[o(v,{label:"商品标题"},{default:a(()=>[o(g,{modelValue:s.title,"onUpdate:modelValue":t[2]||(t[2]=i=>s.title=i),placeholder:"请输入标题",size:"large",disabled:s.status===2},null,8,["modelValue","disabled"])]),_:1}),o(v,{label:"商品描述"},{default:a(()=>[o(g,{modelValue:s.description,"onUpdate:modelValue":t[3]||(t[3]=i=>s.description=i),type:"textarea",rows:"8",placeholder:"描述一下宝贝的转手原因、新旧程度...",resize:"none",disabled:s.status===2},null,8,["modelValue","disabled"])]),_:1}),o(v,{label:"出售价格"},{default:a(()=>[o(g,{modelValue:s.price,"onUpdate:modelValue":t[4]||(t[4]=i=>s.price=i),size:"large",class:"price-input",disabled:s.status===2},{prefix:a(()=>[...t[16]||(t[16]=[n("¥",-1)])]),_:1},8,["modelValue","disabled"])]),_:1}),t[21]||(t[21]=e("div",{class:"divider"},null,-1)),e("div",lt,[s.status!==2?(d(),c(V,{key:0},[o(u,{type:"primary",color:"#ffdf5d",size:"large",class:"save-btn",onClick:z},{default:a(()=>[...t[17]||(t[17]=[n(" 保存修改 ",-1)])]),_:1}),o(u,{size:"large",round:"",onClick:t[5]||(t[5]=i=>l.$router.go(-1))},{default:a(()=>[...t[18]||(t[18]=[n("取消",-1)])]),_:1})],64)):(d(),c(V,{key:1},[o(u,{size:"large",round:"",disabled:"",class:"disabled-save"},{default:a(()=>[...t[19]||(t[19]=[n("无法修改",-1)])]),_:1}),o(u,{size:"large",round:"",onClick:t[6]||(t[6]=i=>l.$router.go(-1))},{default:a(()=>[...t[20]||(t[20]=[n("返回",-1)])]),_:1})],64))])]),_:1},8,["model"])])])])),[[D,f.value]])}}},dt=P(nt,[["__scopeId","data-v-966727cf"]]);export{dt as default};
