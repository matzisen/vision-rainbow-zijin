import{_ as I,r as v,o as L,c as y,d,e,f as a,w as C,g as o,u as p,S as N,h as i,z as P,A as S,b as W,j as g,V as K,t as _,n as U,k as w,W as j,X,s as B,E as A,v as q}from"./index-Drt15aFz.js";const F={class:"page-wrapper"},G={class:"content-card"},H={class:"card-header"},J={class:"right-panel"},O={class:"search-capsule"},Q={class:"table-container"},R={class:"product-cell"},Y={class:"img-box"},Z={class:"img-err"},tt={class:"p-text"},et=["title"],st={class:"desc"},at={class:"price-tag"},ot={class:"seller-cell"},lt={class:"name"},nt=["onClick"],ct=["onClick"],it={key:2,class:"disabled-text"},rt={class:"pagination-footer"},dt="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",_t={__name:"ProductAudit",setup(ut){const h=v(!1),m=v([]),u=v(""),b=s=>s?s.startsWith("http")?s.replace("localhost","127.0.0.1"):"http://127.0.0.1:8081"+s:"",f=async()=>{h.value=!0;try{const s=localStorage.getItem("admin_token");let n=(await B.get("/api/admin/products",{headers:{Authorization:s}})).data||[];if(u.value){const r=u.value.toLowerCase();n=n.filter(c=>c.name&&c.name.toLowerCase().includes(r))}m.value=n}catch(s){console.error(s),A.error("获取商品列表失败")}finally{h.value=!1}},k=(s,l)=>{const n=l===3?"强制下架":"重新上架";q.confirm(`确定要${n}商品“${s.name||"此商品"}”吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:l===3?"warning":"info",center:!0,customClass:"warm-theme-box"}).then(async()=>{const r=localStorage.getItem("admin_token");await B.put(`/api/admin/products/${s.id}/audit`,{status:l},{headers:{Authorization:r}}),A.success("操作成功"),s.status=l}).catch(()=>{})},z=s=>({1:"在售",2:"已售",3:"违规下架"})[s]||"未知",T=s=>({1:"sale",2:"sold",3:"ban"})[s]||"";return L(f),(s,l)=>{const n=i("el-icon"),r=i("el-image"),c=i("el-table-column"),V=i("el-avatar"),x=i("el-tooltip"),$=i("el-table"),D=i("el-pagination"),E=W("loading");return d(),y("div",F,[e("div",G,[e("div",H,[l[1]||(l[1]=e("div",{class:"left-panel"},[e("h2",{class:"page-title"},"商品审核"),e("span",{class:"subtitle"},"审核用户发布的内容，维护平台环境")],-1)),e("div",J,[e("div",O,[a(n,{class:"search-icon"},{default:o(()=>[a(p(N))]),_:1}),C(e("input",{"onUpdate:modelValue":l[0]||(l[0]=t=>u.value=t),placeholder:"搜索商品名称...",onKeyup:S(f,["enter"])},null,544),[[P,u.value]]),e("button",{onClick:f},"搜索")])])]),e("div",Q,[C((d(),g($,{data:m.value,style:{width:"100%"},"header-cell-style":{background:"#fff",color:"#8c9bae",fontWeight:"600",borderBottom:"1px solid #f0f0f0"}},{default:o(()=>[a(c,{label:"商品信息","min-width":"320"},{default:o(t=>[e("div",R,[e("div",Y,[a(r,{src:b(t.row.image),"preview-src-list":[b(t.row.image)],fit:"cover","preview-teleported":"",class:"p-img"},{error:o(()=>[e("div",Z,[a(n,null,{default:o(()=>[a(p(K))]),_:1})])]),_:1},8,["src","preview-src-list"])]),e("div",tt,[e("div",{class:"title",title:t.row.name},_(t.row.name||t.row.title||"未知商品"),9,et),e("div",st,_(t.row.description||"暂无描述"),1)])])]),_:1}),a(c,{prop:"price",label:"价格",width:"120"},{default:o(t=>[e("span",at,"¥ "+_(t.row.price),1)]),_:1}),a(c,{label:"发布人",width:"180"},{default:o(t=>[e("div",ot,[a(V,{size:28,src:t.row.user?.avatar||dt},null,8,["src"]),e("span",lt,_(t.row.user?.nickname||t.row.user?.username||"未知用户"),1)])]),_:1}),a(c,{label:"状态",width:"120"},{default:o(t=>[e("span",{class:U(["status-pill",T(t.row.status)])},_(z(t.row.status)),3)]),_:1}),a(c,{label:"操作",fixed:"right",width:"140",align:"right"},{default:o(t=>[t.row.status===1?(d(),g(x,{key:0,content:"强制下架",placement:"top"},{default:o(()=>[e("div",{class:"icon-btn danger",onClick:M=>k(t.row,3)},[a(n,null,{default:o(()=>[a(p(j))]),_:1})],8,nt)]),_:2},1024)):w("",!0),t.row.status===3?(d(),g(x,{key:1,content:"重新上架",placement:"top"},{default:o(()=>[e("div",{class:"icon-btn success",onClick:M=>k(t.row,1)},[a(n,null,{default:o(()=>[a(p(X))]),_:1})],8,ct)]),_:2},1024)):w("",!0),t.row.status===2?(d(),y("span",it,"已售出")):w("",!0)]),_:1})]),_:1},8,["data"])),[[E,h.value]])]),e("div",rt,[a(D,{background:"",layout:"prev, pager, next",total:m.value.length,"page-size":10,disabled:""},null,8,["total"])])])])}}},ht=I(_t,[["__scopeId","data-v-c7e11d1a"]]);export{ht as default};
